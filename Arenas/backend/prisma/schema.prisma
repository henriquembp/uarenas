// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  TEACHER
  STUDENT
  VISITOR
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

enum StockMovementType {
  ENTRY
  EXIT
  ADJUSTMENT
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  name          String
  phone         String?
  role          UserRole  @default(VISITOR)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relações
  bookings      Booking[]
  classesAsStudent ClassStudent[]
  classesAsTeacher Class[] @relation("ClassTeacher")
  invoices      Invoice[]
  stockMovements StockMovement[]
  sales         Sale[]

  @@map("users")
}

model Court {
  id          String   @id @default(uuid())
  name        String
  description String?
  sportType   String   // "volei", "futevolei", "beach_tennis"
  isActive    Boolean  @default(true)
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relações
  bookings    Booking[]
  classes     Class[]

  @@map("courts")
}

model Booking {
  id          String        @id @default(uuid())
  userId      String
  courtId     String
  date        DateTime
  startTime   String        // Formato HH:mm
  endTime     String        // Formato HH:mm
  status      BookingStatus @default(PENDING)
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relações
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  court       Court         @relation(fields: [courtId], references: [id], onDelete: Cascade)

  @@map("bookings")
}

model Class {
  id          String   @id @default(uuid())
  name        String
  description String?
  courtId     String
  teacherId   String
  dayOfWeek   Int      // 0 = Domingo, 1 = Segunda, ..., 6 = Sábado
  startTime   String   // Formato HH:mm
  endTime     String   // Formato HH:mm
  startDate   DateTime
  endDate     DateTime?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relações
  court       Court    @relation(fields: [courtId], references: [id], onDelete: Cascade)
  teacher     User     @relation("ClassTeacher", fields: [teacherId], references: [id], onDelete: Cascade)
  students    ClassStudent[]
  invoices    Invoice[]

  @@map("classes")
}

model ClassStudent {
  id        String   @id @default(uuid())
  classId   String
  studentId String
  joinedAt  DateTime @default(now())
  leftAt    DateTime?

  // Relações
  class     Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  student   User     @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([classId, studentId])
  @@map("class_students")
}

model Invoice {
  id          String        @id @default(uuid())
  userId      String
  classId     String?
  description String
  amount      Decimal       @db.Decimal(10, 2)
  dueDate     DateTime
  paidDate    DateTime?
  status      InvoiceStatus @default(PENDING)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relações
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  class       Class?        @relation(fields: [classId], references: [id], onDelete: SetNull)

  @@map("invoices")
}

model Store {
  id          String   @id @default(uuid())
  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relações
  products    Product[]

  @@map("stores")
}

model Product {
  id          String   @id @default(uuid())
  storeId     String
  name        String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  cost        Decimal? @db.Decimal(10, 2)
  sku         String?  @unique
  barcode     String?
  imageUrl    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relações
  store       Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)
  stockMovements StockMovement[]
  saleItems   SaleItem[]

  @@map("products")
}

model StockMovement {
  id          String            @id @default(uuid())
  productId   String
  userId      String?           // Usuário que fez o movimento
  type        StockMovementType
  quantity    Int
  notes       String?
  createdAt   DateTime          @default(now())

  // Relações
  product     Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  user        User?             @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("stock_movements")
}

model Sale {
  id          String   @id @default(uuid())
  userId      String   // Vendedor
  total       Decimal  @db.Decimal(10, 2)
  notes       String?
  createdAt   DateTime @default(now())

  // Relações
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  items       SaleItem[]

  @@map("sales")
}

model SaleItem {
  id          String   @id @default(uuid())
  saleId      String
  productId   String
  quantity    Int
  unitPrice   Decimal  @db.Decimal(10, 2)
  subtotal    Decimal  @db.Decimal(10, 2)

  // Relações
  sale        Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("sale_items")
}



